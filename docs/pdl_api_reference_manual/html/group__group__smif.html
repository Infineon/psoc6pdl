<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSoC 6 Peripheral Driver Library: SMIF         (Serial Memory Interface)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSoC 6 Peripheral Driver Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__smif.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">SMIF (Serial Memory Interface)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>The SPI-based communication interface for external memory devices. </p>
<p>The functions and other declarations used in this driver are in cy_smif.h and cy_smif_memslot.h (if used). If you are using the ModusToolbox QSPI Configurator, also include cycfg_qspi_memslot.h.</p>
<p>SMIF: Serial Memory Interface: This IP block implements an SPI-based communication interface for interfacing external memory devices to PSoC. The SMIF supports Octal-SPI, Dual Quad-SPI, Quad-SPI, Dual-SPI, and SPI.</p>
<p>Features</p><ul>
<li>Standard SPI Master interface</li>
<li>Supports Single/Dual/Quad/Octal SPI Memories</li>
<li>Supports Dual-Quad SPI mode</li>
<li>Design-time configurable support for multiple (up to 4) external serial memory devices</li>
<li>eXecute-In-Place (XIP) operation mode for both read and write accesses with 4KB XIP read cache and on-the-fly encryption and decryption</li>
<li>Supports external serial memory initialization via <a href="https://www.jedec.org/standards-documents/docs/jesd216b" target="_blank">Serial Flash Discoverable Parameters (SFDP)</a> standard</li>
</ul>
<p>The primary usage model for the SMIF is that of an external memory interface. The SMIF is capable of interfacing with different types of memory, up to four types.</p>
<p><b>SMIF</b> driver is divided into three layers</p><ul>
<li>cy_smif.h API</li>
<li>cy_smif_memslot.h API</li>
<li>SMIF configuration structures</li>
</ul>
<p>The SMIF API is divided into the low-level functions and memory-slot functions. Use the low level API for the SMIF block initialization and for implementing a generic SPI communication interface using the SMIF block.</p>
<p>The memory slot API has functions to implement the basic memory operations such as program, read, erase etc. These functions are implemented using the memory parameters in the memory device configuration data structure. The <a class="el" href="group__group__smif__mem__slot__functions.html#ga52af5f4a06759b38f2cff0b7114d5910" title="This function initializes the slots of the memory device in the SMIF configuration. ">Cy_SMIF_Memslot_Init()</a> API initializes all the memory slots based on the settings in the array.</p>
<div class="image">
<img src="smif_1_0_p01_layers.png" alt="smif_1_0_p01_layers.png"/>
</div>
<p>SMIF Configuration Tool is a stand-alone application, which is a part of PDL (Creator) and could be found in &lt;PDL_DIR&gt;/tools/&lt;OS_DIR&gt;/SMIFConfigurationTool (e.g. for PDL 3.0.0 and Windows OS PDL/3.0.0/tools/win/SMIFConfigurationTool).</p>
<p>In ModusToolbox this tool is called QSPI Configurator. QSPI Configurator is a part of PSoC 6 Software Library and can be found in &lt;ModusToolbox&gt;/tools/qspi-configurator-1.0</p>
<p>Tool generates *.c and *.h file with configuration structures. These configuration structures are input parameters for cy_smif_memslot API level</p>
<dl class="section warning"><dt>Warning</dt><dd>The driver is not responsible for external memory persistence. You cannot edit a buffer during the Read/Write operations. If there is a memory error, the SMIF ip block can require a reset. To determine if this has happened, check the SMIF busy status using <a class="el" href="group__group__smif__low__level__functions.html#ga58e965697047847ce906329eb6b5341c" title="This function provides the status of the IP block (False - not busy, True - busy). ">Cy_SMIF_BusyCheck()</a> and implement a timeout. Reset the SMIF block by toggling CTL.ENABLED. Then reconfigure the SMIF block.</dd></dl>
<p>For the Write operation, check that the SMIF driver has completed transferring by calling <a class="el" href="group__group__smif__low__level__functions.html#ga58e965697047847ce906329eb6b5341c" title="This function provides the status of the IP block (False - not busy, True - busy). ">Cy_SMIF_BusyCheck()</a>. Also, check that the memory is available with <a class="el" href="group__group__smif__mem__slot__functions.html#ga85667bff2dd7d864229ffa6d375359d3" title="This function checks if the status of the memory device is busy. ">Cy_SMIF_Memslot_IsBusy()</a> before proceeding.</p>
<p>Simple example of external flash memory programming using low level SMIF API. All steps mentioned in example below are incorporated in <a class="el" href="group__group__smif__mem__slot__functions.html#ga83284b0642995573c9879dc6d56d8069">Cy_SMIF_Memslot_CmdWriteEnable()</a>, <a class="el" href="group__group__smif__mem__slot__functions.html#ga72451802e1dc0afdda2bf184ca5ade61">Cy_SMIF_Memslot_CmdProgram()</a>, and <a class="el" href="group__group__smif__mem__slot__functions.html#ga85667bff2dd7d864229ffa6d375359d3">Cy_SMIF_Memslot_IsBusy()</a> of the <a class="el" href="group__group__smif__mem__slot__functions.html">memory slot level API</a>. </p><dl class="section warning"><dt>Warning</dt><dd>Example is simplified, without checks of error conditions. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Flash memories need erase operation before programming. Refer to external memory datasheet for specific memory commands.</dd></dl>
<div class="fragment"><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">/* Enable write operation in external memory. Send Write Enable command to</span></div><div class="line"><span class="comment">     * external memory.  */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#gacc14b1fa349b5d4cd422db6569f0b137">Cy_SMIF_TransmitCommand</a>( SMIF,                            </div><div class="line">                            0x06, <span class="comment">/* External memory write enable command */</span>                 </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                            CMD_WITHOUT_PARAM, <span class="comment">/* Command does not have parameters */</span></div><div class="line">                            CMD_WITHOUT_PARAM, </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312ae942102fb4b1a03a13ca8950b607520d">CY_SMIF_SLAVE_SELECT_0</a>, <span class="comment">/* External memory connected to nSS0 */</span></div><div class="line">                            1U, <span class="comment">/* Disable nSS after command transfered */</span></div><div class="line">                            &amp;smifContext); </div><div class="line">    </div><div class="line">    <span class="comment">/* Wait while SMIF IP is transferring command to external memory */</span></div><div class="line">    <span class="keywordflow">while</span>(<a class="code" href="group__group__smif__low__level__functions.html#ga58e965697047847ce906329eb6b5341c">Cy_SMIF_BusyCheck</a>(SMIF));</div><div class="line"></div><div class="line">    uint8_t tst_txBuffer[TX_SIZE]; <span class="comment">/* Buffer to put read date */</span></div><div class="line">    </div><div class="line">    <span class="comment">/* Send page program command to external memory */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#gacc14b1fa349b5d4cd422db6569f0b137">Cy_SMIF_TransmitCommand</a>( SMIF,                             </div><div class="line">                            0x02,   <span class="comment">/* Page Program external memory command */</span>  </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>,</div><div class="line">                            address, </div><div class="line">                            MEMORY_ADDRESS_SIZE, </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312ae942102fb4b1a03a13ca8950b607520d">CY_SMIF_SLAVE_SELECT_0</a>, </div><div class="line">                            0U, <span class="comment">/* Not last byte, does not disable nSS line */</span></div><div class="line">                            &amp;smifContext);</div><div class="line">    <span class="comment">/* Send programming data to external memory */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#ga844fc7eb8b2f79e734a934b021616eaf">Cy_SMIF_TransmitData</a>(SMIF, tst_txBuffer, TX_SIZE, <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                            NULL, <span class="comment">/* Callback function is not used */</span></div><div class="line">                            &amp;smifContext);</div><div class="line">    </div><div class="line">    <span class="comment">/* Wait while SMIF transfers data */</span></div><div class="line">    <span class="keywordflow">while</span>(<a class="code" href="group__group__smif__low__level__functions.html#ga58e965697047847ce906329eb6b5341c">Cy_SMIF_BusyCheck</a>(SMIF));</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">/* Wait until the memory is programed. Cy_SMIF_Memslot_IsBusy() of memslot</span></div><div class="line"><span class="comment">     * API level could be used instead */</span></div><div class="line">    <span class="keywordtype">bool</span> memBusy;</div><div class="line">    </div><div class="line">    <span class="keywordflow">do</span></div><div class="line">    {</div><div class="line">        uint8_t readReg = 0U;</div><div class="line">        </div><div class="line">        <span class="comment">/* Read the memory status register */</span></div><div class="line">        <a class="code" href="group__group__smif__low__level__functions.html#gacc14b1fa349b5d4cd422db6569f0b137">Cy_SMIF_TransmitCommand</a>( SMIF,</div><div class="line">                                0x05, <span class="comment">/* Read status register of external memory */</span>               </div><div class="line">                                <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>,</div><div class="line">                                CMD_WITHOUT_PARAM, </div><div class="line">                                CMD_WITHOUT_PARAM, </div><div class="line">                                <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                                <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312ae942102fb4b1a03a13ca8950b607520d">CY_SMIF_SLAVE_SELECT_0</a>, </div><div class="line">                                0U, <span class="comment">/* Not last byte, does not disable nSS line */</span> </div><div class="line">                                &amp;smifContext);</div><div class="line">        <a class="code" href="group__group__smif__low__level__functions.html#ga1de0ddec4fed5235d2a6d82ed36a8224">Cy_SMIF_ReceiveData</a>(SMIF, &amp;readReg,                    </div><div class="line">                            1U, <span class="comment">/* Read 1-byte */</span> </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                            NULL, <span class="comment">/* Callback function is not used */</span></div><div class="line">                            &amp;smifContext);</div><div class="line"></div><div class="line">        <span class="comment">/* Check if the SMIF IP is busy */</span></div><div class="line">        <span class="keywordflow">while</span>(<a class="code" href="group__group__smif__low__level__functions.html#ga58e965697047847ce906329eb6b5341c">Cy_SMIF_BusyCheck</a>(SMIF));</div><div class="line"></div><div class="line">        memBusy = ((readReg &amp; MEM_WIP_MASK) != 0U);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">while</span>(memBusy);</div></div><!-- fragment --><p> For the Read operation, before accessing the read buffer, check that it is ready by calling <a class="el" href="group__group__smif__low__level__functions.html#ga10662c147b39a1b71a2f2221b0e3f59f" title="This function is used to read the status of the TX FIFO. ">Cy_SMIF_GetTxFifoStatus()</a>.</p>
<p>Simple example of external flash memory read using low level SMIF API. All steps mentioned in example below are incorporated in <a class="el" href="group__group__smif__mem__slot__functions.html#gaac62de622690e4cde8b51945595291b1">Cy_SMIF_Memslot_CmdRead()</a> of the <a class="el" href="group__group__smif__mem__slot__functions.html">memory slot level API</a>. </p><dl class="section warning"><dt>Warning</dt><dd>Example is simplified, without checks of error conditions. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Refer to external memory datasheet for specific memory commands.</dd></dl>
<div class="fragment"><div class="line">     <span class="comment">/* Read memory data */</span></div><div class="line">    uint8_t address[MEMORY_ADDRESS_SIZE] = {0,0,0}; <span class="comment">/* Read from 3-byte 0 address */</span></div><div class="line">    uint8_t tst_rxBuffer[RX_SIZE]; <span class="comment">/* Buffer to put read date */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#gacc14b1fa349b5d4cd422db6569f0b137">Cy_SMIF_TransmitCommand</a>(SMIF,                            </div><div class="line">                            0x03,    <span class="comment">/* External memory Read command code */</span>            </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, <span class="comment">/* Normal SPI mode */</span></div><div class="line">                            address, </div><div class="line">                            MEMORY_ADDRESS_SIZE, </div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>,</div><div class="line">                            <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312ae942102fb4b1a03a13ca8950b607520d">CY_SMIF_SLAVE_SELECT_0</a>, <span class="comment">/* External memory connected to nSS0 */</span></div><div class="line">                            0U, <span class="comment">/* Not last byte, does not disable nSS line */</span></div><div class="line">                            &amp;smifContext);</div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#ga1de0ddec4fed5235d2a6d82ed36a8224">Cy_SMIF_ReceiveData</a>(SMIF, tst_rxBuffer, RX_SIZE, <a class="code" href="group__group__smif__enums.html#ggab71e4b1f4c80b3e8c82dd85570415e44ac1096798c3195819d57ad16de46b4ed7">CY_SMIF_WIDTH_SINGLE</a>, </div><div class="line">                            NULL, <span class="comment">/* Callback function is not used */</span></div><div class="line">                            &amp;smifContext);</div><div class="line">    </div><div class="line">    <span class="comment">/* Check SMIF fishes reading operation */</span></div><div class="line">    <span class="keywordflow">while</span>(<a class="code" href="group__group__smif__low__level__functions.html#ga204a3b405014b0bda6bea07c210e6ecd">Cy_SMIF_GetTxfrStatus</a>(SMIF, &amp;smifContext) == <a class="code" href="group__group__smif__enums.html#ggaf65a7e26c18fcd3d3469eb083f78bb85a190c04ec39d39e014cd9a5d4f8efab68">CY_SMIF_REC_BUSY</a>);</div></div><!-- fragment --><p> The user should invalidate the cache by calling <a class="el" href="group__group__smif__low__level__functions.html#ga93036af50ddd10ec813f3e68dd4974d3" title="This function is used to invalidate/clear the fast cache, the slow cache or both. ...">Cy_SMIF_CacheInvalidate()</a> when switching from the MMIO mode to XIP mode.</p>
<h1><a class="anchor" id="group_smif_configuration"></a>
Configuration Considerations</h1>
<p>PDL API has common parameters: base, context, config described in <a class="el" href="page_getting_started.html#page_getting_started_pdl_design">PDL Design</a> section.</p>
<p>See the documentation for <a class="el" href="group__group__smif__low__level__functions.html#gaea2684847f04e2e7e2c85cfe7fd37881" title="This function initializes the SMIF block as a communication block. ">Cy_SMIF_Init()</a> and <a class="el" href="group__group__smif__mem__slot__functions.html#ga52af5f4a06759b38f2cff0b7114d5910" title="This function initializes the slots of the memory device in the SMIF configuration. ">Cy_SMIF_Memslot_Init()</a> for details on the required configuration structures and other initialization topics.</p>
<p>The normal (MMIO) mode is used for implementing a generic SPI/DSPI/QSPI/Dual Quad-SPI/Octal-SPI communication interface using the SMIF block. This interface can be used to implement special commands like Program/Erase of flash, memory device configuration, sleep mode entry for memory devices or other special commands specific to the memory device. The transfer width (SPI/DSP/Quad-SPI/Octal-SPI) of a transmission is a parameter set for each transmit/receive operation. So these can be changed at run time.</p>
<p>In a typical memory interface with flash memory, the SMIF is used in the memory mode when reading from the memory and it switches to the normal mode when writing to flash memory. A typical memory device has multiple types of commands.</p>
<p>The SMIF interface can be used to transmit different types of commands. Each command has different phases: command, dummy cycles, and transmit and receive data which require separate APIs.</p>
<h2><a class="anchor" id="group_smif_init"></a>
SMIF Initialization</h2>
<p>Create interrupt function and allocate memory for SMIF context structure </p><div class="fragment"><div class="line"><a class="code" href="structcy__stc__smif__context__t.html">cy_stc_smif_context_t</a> smifContext;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> SMIF_Interrupt_User(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#gaedbec6f968745b8f594dd4b32e91ceba">Cy_SMIF_Interrupt</a>(SMIF, &amp;smifContext);</div><div class="line">}</div></div><!-- fragment --><p>SMIF driver initialization for low level API usage (cysmif.h) </p><div class="fragment"><div class="line">    </div><div class="line">    <span class="comment">/* Main configuration paramters*/</span></div><div class="line"><span class="preprocessor">    #define NUMBER_OF_EXTERNAL_MEM      (2U)</span></div><div class="line"><span class="preprocessor">    #define SMIF_PRIORITY               (1U)</span></div><div class="line"><span class="preprocessor">    #define TIMEOUT_1_S                 (1000U)</span></div><div class="line"><span class="preprocessor">    #define DESELECT_DELAY              (7U)</span></div><div class="line"><span class="preprocessor">    #define RX_CLOCK_SELECT             (1U)</span></div><div class="line"></div><div class="line">    <span class="comment">/* Pin initialization */</span></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">/* SMIF interrupt initialization */</span> </div><div class="line">    <a class="code" href="structcy__stc__sysint__t.html">cy_stc_sysint_t</a> smifIntConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .intrSrc */</span> smif_interrupt_IRQn, <span class="comment">/* SMIF interrupt number (non M0 core)*/</span></div><div class="line">        <span class="comment">/* .intrPriority */</span> SMIF_PRIORITY</div><div class="line">    };</div><div class="line">    <a class="code" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d">Cy_SysInt_Init</a>(&amp;smifIntConfig, SMIF_Interrupt_User);</div><div class="line">    </div><div class="line">    __enable_irq(); <span class="comment">/* Enable global interrupts. */</span></div><div class="line">    </div><div class="line">    <span class="comment">/* Enable SMIF interrupt */</span></div><div class="line">    NVIC_EnableIRQ(smif_interrupt_IRQn);</div><div class="line">    </div><div class="line">    <span class="comment">/* SMIF configuration parameters */</span></div><div class="line">    <a class="code" href="structcy__stc__smif__config__t.html">cy_stc_smif_config_t</a> tst_smifConfig = </div><div class="line">    {   </div><div class="line">        <span class="comment">/* .mode           */</span> <a class="code" href="group__group__smif__enums.html#gga2baa7c37d2cedf2e2c837facc753ab5da4fe852fb31547c77b31203ec5c43ca91">CY_SMIF_NORMAL</a>,      <span class="comment">/* Mode of operation */</span>         </div><div class="line">        <span class="comment">/* .deselectDelay  */</span> DESELECT_DELAY,      <span class="comment">/* Minimum duration of SPI deselection */</span>  </div><div class="line">        <span class="comment">/* .rxClockSel     */</span> RX_CLOCK_SELECT,     <span class="comment">/* Clock source for the receiver clock */</span>  </div><div class="line">        <span class="comment">/* .blockEvent     */</span> <a class="code" href="group__group__smif__enums.html#ggaf2f886b17b9d40712b212e704665341ea4ee6427df49e552167b2eb7a70f4afc4">CY_SMIF_BUS_ERROR</a>    <span class="comment">/* What happens when there is a read </span></div><div class="line"><span class="comment">                                                    * to an empty RX FIFO or write to a full TX FIFO</span></div><div class="line"><span class="comment">                                                    */</span>  </div><div class="line">    };</div><div class="line">    </div><div class="line">    <span class="comment">/* SMIF initialization */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#gaea2684847f04e2e7e2c85cfe7fd37881">Cy_SMIF_Init</a>(SMIF, &amp;tst_smifConfig, TIMEOUT_1_S, &amp;smifContext);</div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#ga5428ca682fd56b837a1a3763fc2596b8">Cy_SMIF_Enable</a>(SMIF, &amp;smifContext);</div><div class="line">    </div></div><!-- fragment --><p>Additional steps to initialize SMIF driver for memory slot level API usage (cy_smif_memslot.h). </p><div class="fragment"><div class="line">    </div><div class="line">    <span class="comment">/* Configuration parameters for memory S25FL512S*/</span></div><div class="line">    <a class="code" href="structcy__stc__smif__mem__device__cfg__t.html">cy_stc_smif_mem_device_cfg_t</a> S25FL512S;</div><div class="line">    <span class="comment">/* Configuration parameters for memory configuration autodetection*/</span></div><div class="line">    <a class="code" href="structcy__stc__smif__mem__device__cfg__t.html">cy_stc_smif_mem_device_cfg_t</a> autodetectedMemory;</div><div class="line">    </div><div class="line">    <a class="code" href="structcy__stc__smif__mem__config__t.html">cy_stc_smif_mem_config_t</a> memSs0 =    </div><div class="line">    { </div><div class="line">        <span class="comment">/* .slaveSelect */</span> <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312ae942102fb4b1a03a13ca8950b607520d">CY_SMIF_SLAVE_SELECT_0</a>,                    <span class="comment">/* Determines the slot number where the memory device is placed */</span> </div><div class="line">        <span class="comment">/* .flags */</span> <a class="code" href="group__group__smif__macros__flags.html#ga29c9ff0df16794497a73170841902770">CY_SMIF_FLAG_MEMORY_MAPPED</a> | <a class="code" href="group__group__smif__macros__flags.html#gae04dcdd0b4dfb639a150e9a232df6839">CY_SMIF_FLAG_WR_EN</a>, <span class="comment">/* Determines if the device is memory mapped. If enabled this memory slot will be initialised in System init */</span> </div><div class="line">        <span class="comment">/* .dataSelect */</span> <a class="code" href="group__group__smif__enums.html#gga6d9ba2ef785b94cf542c573a51a0eb58a7544d58a69a1a2308ebd0cac9099cd24">CY_SMIF_DATA_SEL0</a>,       <span class="comment">/* Data line selection options for a slave device */</span>    </div><div class="line">        <span class="comment">/* .baseAddress */</span> 0x18000000,             <span class="comment">/* The base address the memory slave is mapped to in the PSoC memory map. Valid when memory mapped mode is enabled */</span></div><div class="line">        <span class="comment">/* .memMappedSize */</span> 0xFFE00000,           <span class="comment">/* The size allocated in the PSoC memory map, for the memory slave device. The size is allocated from the base address</span></div><div class="line"><span class="comment">                                                    * Valid when memory mapped mode is enabled */</span></div><div class="line">        <span class="comment">/* .dualQuadSlots */</span> 0x0,</div><div class="line">        <span class="comment">/* .deviceCfg */</span> &amp;S25FL512S                <span class="comment">/* Configuration of the device */</span>    </div><div class="line">    };</div><div class="line">    </div><div class="line">    <a class="code" href="structcy__stc__smif__mem__config__t.html">cy_stc_smif_mem_config_t</a> memSs1 =    </div><div class="line">    { </div><div class="line">        <span class="comment">/* .slaveSelect */</span> <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312abcce904a4fb5c59af91665287c2cc906">CY_SMIF_SLAVE_SELECT_1</a>, <span class="comment">/* Determines the slot number where the memory device is placed */</span> </div><div class="line">        <span class="comment">/* .flags */</span> <a class="code" href="group__group__smif__macros__flags.html#ga23e01da45ea8e930e94279967557a1c5">CY_SMIF_FLAG_DETECT_SFDP</a>,     <span class="comment">/* Determines if the device is memory mapped. If enabled this memory slot will be initialised in System init */</span> </div><div class="line">        <span class="comment">/* .dataSelect */</span> <a class="code" href="group__group__smif__enums.html#gga6d9ba2ef785b94cf542c573a51a0eb58adb81ab40b00daad8ed642d06a9fd96a4">CY_SMIF_DATA_SEL2</a>,       <span class="comment">/* Data line selection options for a slave device */</span></div><div class="line">        <span class="comment">/* .baseAddress */</span> 0x0,</div><div class="line">        <span class="comment">/* .memMappedSize */</span> 0x0,</div><div class="line">        <span class="comment">/* .dualQuadSlots */</span> 0x0,</div><div class="line">        <span class="comment">/* .deviceCfg */</span> &amp;autodetectedMemory       <span class="comment">/* Configuration of the device */</span>    </div><div class="line">    };</div><div class="line">    </div><div class="line">    <a class="code" href="structcy__stc__smif__mem__config__t.html">cy_stc_smif_mem_config_t</a>* smifMemConfigs[NUMBER_OF_EXTERNAL_MEM] = {</div><div class="line">        &amp;memSs0,</div><div class="line">        &amp;memSs1,</div><div class="line">    };</div><div class="line">    </div><div class="line">    <a class="code" href="structcy__stc__smif__block__config__t.html">cy_stc_smif_block_config_t</a> smifBlockConfig =</div><div class="line">    {</div><div class="line">        <span class="comment">/* .memCount */</span> NUMBER_OF_EXTERNAL_MEM,    <span class="comment">/* Number of SMIF memories defined  */</span></div><div class="line">        <span class="comment">/* .memConfig */</span> smifMemConfigs,           <span class="comment">/* Pointer to the array of memory configuration structures of size memCount */</span></div><div class="line">        <span class="comment">/* .majorVersion */</span> 1,                     <span class="comment">/* Version of the SMIF driver */</span></div><div class="line">        <span class="comment">/* .minorVersion */</span> 0                      <span class="comment">/* Version of the SMIF Driver */</span></div><div class="line">    };</div><div class="line">    </div><div class="line">    <span class="comment">/* Memslot level initialization */</span></div><div class="line">    <a class="code" href="group__group__smif__mem__slot__functions.html#ga52af5f4a06759b38f2cff0b7114d5910">Cy_SMIF_Memslot_Init</a>(SMIF, &amp;smifBlockConfig, &amp;smifContext);</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Example does not include initialization of all needed configuration structures (<a class="el" href="structcy__stc__smif__mem__device__cfg__t.html">cy_stc_smif_mem_device_cfg_t</a>, <a class="el" href="structcy__stc__smif__mem__cmd__t.html">cy_stc_smif_mem_cmd_t</a>). SMIF/QSPI Configuration tool generates all configuration structures needed for memslot level API usage.</dd></dl>
<h2><a class="anchor" id="group_smif_xip_init"></a>
SMIF XIP Initialization</h2>
<p>The eXecute In Place (XIP) is a mode of operation where read or write commands to the memory device are directed through the SMIF without any use of API function calls. In this mode the SMIF block maps the AHB bus-accesses to external memory device addresses to make it behave similar to internal memory. This allows the CPU to execute code directly from external memory. This mode is not limited to code and is suitable also for data read and write accesses. </p><div class="fragment"><div class="line"></div><div class="line">    <span class="comment">/* SMIF IP initialization */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#gaea2684847f04e2e7e2c85cfe7fd37881">Cy_SMIF_Init</a>(SMIF, &amp;tst_smifConfig, TIMEOUT_1_S, &amp;smifContext);</div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#ga1df033f6664a2b41cf044f2c4ec60817">Cy_SMIF_SetDataSelect</a>(SMIF, <a class="code" href="group__group__smif__enums.html#ggad776a0db9224477ab865254a32d9e312ae942102fb4b1a03a13ca8950b607520d">CY_SMIF_SLAVE_SELECT_0</a>, <a class="code" href="group__group__smif__enums.html#gga6d9ba2ef785b94cf542c573a51a0eb58a7544d58a69a1a2308ebd0cac9099cd24">CY_SMIF_DATA_SEL0</a>);</div><div class="line">    <a class="code" href="group__group__smif__mem__slot__functions.html#ga52af5f4a06759b38f2cff0b7114d5910">Cy_SMIF_Memslot_Init</a>(SMIF, &amp;smifBlockConfig, &amp;smifContext);</div><div class="line">    </div><div class="line">    <span class="comment">/* Set XIP mode */</span></div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#ga957f49ed7cf091e9b9d736ee589f2583">Cy_SMIF_SetMode</a>(SMIF, <a class="code" href="group__group__smif__enums.html#gga2baa7c37d2cedf2e2c837facc753ab5da562131834e2b77b141db45354e8584ec">CY_SMIF_MEMORY</a>);</div><div class="line">    </div><div class="line">    <a class="code" href="group__group__smif__low__level__functions.html#ga5428ca682fd56b837a1a3763fc2596b8">Cy_SMIF_Enable</a>(SMIF, (<a class="code" href="structcy__stc__smif__context__t.html">cy_stc_smif_context_t</a> *)&amp;smifContext);</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Example of input parameters initialization is in <a class="el" href="group__group__smif.html#group_smif_init">SMIF Initialization</a> section. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Functions that called from external memory should be declared with long call attribute.</dd></dl>
<h2><a class="anchor" id="group_smif_usage_rules"></a>
Rules for PSoC6 QSPI/SMIF Block Usage</h2>
<ol type="1">
<li>All operations must use one or more dummy cycles between the PSoC 6 Command and Address phase (when the PSoC 6 MCU drives the data pins) and the device's Response phase (when the device drives the same data pins). Bus contention may occur if no (zero) dummy cycles are used.</li>
<li>Any transfer that does not allow dummy cycles (such as Register Status Reads) must use the single-bit transfer mode. In single-bit mode, the PSoC 6 drives the Command on the Data0 line and the device responds on the Data1 line, so bus contention cannot occur.</li>
</ol>
<h1><a class="anchor" id="group_smif_more_information"></a>
More Information</h1>
<p>More information regarding the Serial Memory Interface can be found in the component datasheet and the Technical Reference Manual (TRM). More information regarding the SMIF Configuration Tool are in SMIF Configuration Tool User Guide located in &lt;PDL_DIR&gt;/tools/&lt;OS_DIR&gt;/SMIFConfigurationTool/ folder</p>
<h1><a class="anchor" id="group_smif_MISRA"></a>
MISRA-C Compliance]</h1>
<table class="doxtable">
<tr>
<th>MISRA rule </th><th>Rule Class (Required/Advisory) </th><th>Rule Description </th><th>Description of Deviation(s)  </th></tr>
<tr>
<td>11.4 </td><td>A </td><td>The cast is be performed between a pointer to the object type and a different pointer to the object type. </td><td>The cast from the pointer to void to the pointer to an unsigned integer does not have any unintended effect, as it is a consequence of the definition of a structure based on hardware registers.  </td></tr>
<tr>
<td>11.5 </td><td>R </td><td>Not performed, the cast that removes any const or volatile qualification from the type addressed by a pointer. </td><td>The removal of the volatile qualification inside the function has no side effects.  </td></tr>
</table>
<h1><a class="anchor" id="group_smif_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td rowspan="5">1.30 </td><td>The CY_SMIF_CMD_FIFO_WR_RX_COUNT_Msk value is changed to 0x0000FFFFUL. </td><td rowspan="4">Driver maintenance.  </td></tr>
<tr>
<td>Added the check of the size parameter in the <a class="el" href="group__group__smif__low__level__functions.html#ga844fc7eb8b2f79e734a934b021616eaf" title="This function is used to transmit data using the SMIF interface. ">Cy_SMIF_TransmitData()</a> function.  </td></tr>
<tr>
<td>Added conditional check for presence of the SMIF hardware IP.  </td></tr>
<tr>
<td>Fixed the wrong erase command in the SFDP protocol for devices with Erase Type 3.  </td></tr>
<tr>
<td>Updated the General Description section with minor changes. Updated the ordering of the parameters descriptions for some functions. Added the text saying that the <a class="el" href="group__group__smif__mem__slot__functions.html#ga52af5f4a06759b38f2cff0b7114d5910" title="This function initializes the slots of the memory device in the SMIF configuration. ">Cy_SMIF_Memslot_Init()</a> function is applicable to use the external memory as memory-mapped to PSoC (XIP mode). Added the snippet for the <a class="el" href="group__group__smif__low__level__functions.html#ga91a32005b94591adb8fd7daa1068ddbc" title="Uses the Encryption engine to create an encrypted result when the input, key and data arrays are prov...">Cy_SMIF_Encrypt()</a> function to show how to use this function. Added below the picture in the Low-Level Functions section the sequence of PDL functions required in a Read or Write transaction. Added the text below the picture about the address. Updated DUMMY COUNT in this picture. Added checking of the size parameter in the <a class="el" href="group__group__smif__low__level__functions.html#ga844fc7eb8b2f79e734a934b021616eaf" title="This function is used to transmit data using the SMIF interface. ">Cy_SMIF_TransmitData()</a> function.  </td><td>Documentation improvement.  </td></tr>
<tr>
<td>1.20.1 </td><td>Added upper limit to size parameter in several functions. </td><td>Documentation improvement.  </td></tr>
<tr>
<td rowspan="3">1.20 </td><td>Flattened the organization of the driver source code into the single source directory and the single include directory.  </td><td>Driver library directory-structure simplification.  </td></tr>
<tr>
<td>Added a new return status and transfer width option for the case when the memory command is not supported. </td><td>Improved the memory command structure usability.  </td></tr>
<tr>
<td>Added register access layer. Use register access macros instead of direct register access using dereferenced pointers. </td><td>Makes register access device-independent, so that the PDL does not need to be recompiled for each supported part number.  </td></tr>
<tr>
<td rowspan="2">1.11 </td><td>Fixed internal function that writes to the SMIF FIFO </td><td>The write function stuck in the loop when write speed in external memory is significantly lower than PSoC CPU core speed and write transfer is not finished during the single function call.   </td></tr>
<tr>
<td>Added optional mode part to the program command flow </td><td>Extend usability of program command  </td></tr>
<tr>
<td>1.10.1 </td><td>Added Low Power Callback section </td><td>Documentation update and clarification  </td></tr>
<tr>
<td>1.10 </td><td>Fix write to external memory from CM0+ core. Add checks of API input parameters. Minor documentation updates </td><td></td></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__smif__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__smif__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__smif__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__smif__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__smif__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__smif__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__smif__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__smif__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>PSoC 6 Peripheral Driver Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
